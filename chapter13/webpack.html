<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack 深入系列 | 技术博客文章总结</title>
    <meta name="description" content="Welcome to come to my blog">
    
    
    <link rel="preload" href="/assets/css/0.styles.3e1d0bd1.css" as="style"><link rel="preload" href="/assets/js/app.c45b4ff4.js" as="script"><link rel="preload" href="/assets/js/44.11b7ef0a.js" as="script"><link rel="prefetch" href="/assets/js/10.9cdf722f.js"><link rel="prefetch" href="/assets/js/100.9b45b75e.js"><link rel="prefetch" href="/assets/js/101.95c4d653.js"><link rel="prefetch" href="/assets/js/102.09cdc274.js"><link rel="prefetch" href="/assets/js/103.985d4863.js"><link rel="prefetch" href="/assets/js/104.66cfb550.js"><link rel="prefetch" href="/assets/js/105.78c4c309.js"><link rel="prefetch" href="/assets/js/106.34be9d25.js"><link rel="prefetch" href="/assets/js/107.0df352d3.js"><link rel="prefetch" href="/assets/js/108.901d6014.js"><link rel="prefetch" href="/assets/js/109.76339f5d.js"><link rel="prefetch" href="/assets/js/11.d22cc24d.js"><link rel="prefetch" href="/assets/js/110.c6e9ec88.js"><link rel="prefetch" href="/assets/js/111.d390a797.js"><link rel="prefetch" href="/assets/js/112.cf502784.js"><link rel="prefetch" href="/assets/js/113.aa449169.js"><link rel="prefetch" href="/assets/js/114.fc2133ce.js"><link rel="prefetch" href="/assets/js/115.523542e3.js"><link rel="prefetch" href="/assets/js/116.c3507815.js"><link rel="prefetch" href="/assets/js/117.23b5b1f0.js"><link rel="prefetch" href="/assets/js/118.5df8c262.js"><link rel="prefetch" href="/assets/js/119.8e1342c2.js"><link rel="prefetch" href="/assets/js/12.636890c7.js"><link rel="prefetch" href="/assets/js/120.01f21153.js"><link rel="prefetch" href="/assets/js/121.7b546d27.js"><link rel="prefetch" href="/assets/js/122.bd8c0286.js"><link rel="prefetch" href="/assets/js/123.f4f16ed2.js"><link rel="prefetch" href="/assets/js/124.ab5935d4.js"><link rel="prefetch" href="/assets/js/125.b29cf321.js"><link rel="prefetch" href="/assets/js/126.ddf1b9eb.js"><link rel="prefetch" href="/assets/js/127.4d63b823.js"><link rel="prefetch" href="/assets/js/128.f63c61cb.js"><link rel="prefetch" href="/assets/js/129.e74fb4b4.js"><link rel="prefetch" href="/assets/js/13.74a454d8.js"><link rel="prefetch" href="/assets/js/130.05f02f04.js"><link rel="prefetch" href="/assets/js/131.bac5f9b9.js"><link rel="prefetch" href="/assets/js/132.a98fffcf.js"><link rel="prefetch" href="/assets/js/133.5b34ebb6.js"><link rel="prefetch" href="/assets/js/14.ffe8d211.js"><link rel="prefetch" href="/assets/js/15.1bcc034f.js"><link rel="prefetch" href="/assets/js/16.87d6c8f3.js"><link rel="prefetch" href="/assets/js/17.576aa97e.js"><link rel="prefetch" href="/assets/js/18.8c80ffa6.js"><link rel="prefetch" href="/assets/js/19.bd2abc77.js"><link rel="prefetch" href="/assets/js/2.0379b669.js"><link rel="prefetch" href="/assets/js/20.56b31195.js"><link rel="prefetch" href="/assets/js/21.81d1d011.js"><link rel="prefetch" href="/assets/js/22.b52a1bed.js"><link rel="prefetch" href="/assets/js/23.76785e7d.js"><link rel="prefetch" href="/assets/js/24.4bcce340.js"><link rel="prefetch" href="/assets/js/25.b2de599f.js"><link rel="prefetch" href="/assets/js/26.944ed78e.js"><link rel="prefetch" href="/assets/js/27.0bbcee1a.js"><link rel="prefetch" href="/assets/js/28.223ed5b6.js"><link rel="prefetch" href="/assets/js/29.b88c0c25.js"><link rel="prefetch" href="/assets/js/3.b3231975.js"><link rel="prefetch" href="/assets/js/30.5754e2d0.js"><link rel="prefetch" href="/assets/js/31.038ca76a.js"><link rel="prefetch" href="/assets/js/32.7f0c55a6.js"><link rel="prefetch" href="/assets/js/33.7fd80664.js"><link rel="prefetch" href="/assets/js/34.8dcb3109.js"><link rel="prefetch" href="/assets/js/35.8b1fdc43.js"><link rel="prefetch" href="/assets/js/36.cf886fc0.js"><link rel="prefetch" href="/assets/js/37.f7abfe5d.js"><link rel="prefetch" href="/assets/js/38.f63c0deb.js"><link rel="prefetch" href="/assets/js/39.9b06b340.js"><link rel="prefetch" href="/assets/js/4.c1de1412.js"><link rel="prefetch" href="/assets/js/40.490eed30.js"><link rel="prefetch" href="/assets/js/41.b5abbdbc.js"><link rel="prefetch" href="/assets/js/42.1f6e4a3a.js"><link rel="prefetch" href="/assets/js/43.5e85acae.js"><link rel="prefetch" href="/assets/js/45.9774ff29.js"><link rel="prefetch" href="/assets/js/46.2cf4bc5b.js"><link rel="prefetch" href="/assets/js/47.bc79b4ef.js"><link rel="prefetch" href="/assets/js/48.0d80c17f.js"><link rel="prefetch" href="/assets/js/49.4fcabf82.js"><link rel="prefetch" href="/assets/js/5.1d97952d.js"><link rel="prefetch" href="/assets/js/50.7d65f488.js"><link rel="prefetch" href="/assets/js/51.2545cb57.js"><link rel="prefetch" href="/assets/js/52.36a2cca1.js"><link rel="prefetch" href="/assets/js/53.64484c50.js"><link rel="prefetch" href="/assets/js/54.52e5411a.js"><link rel="prefetch" href="/assets/js/55.4f773e83.js"><link rel="prefetch" href="/assets/js/56.a5437204.js"><link rel="prefetch" href="/assets/js/57.24dd7861.js"><link rel="prefetch" href="/assets/js/58.86388619.js"><link rel="prefetch" href="/assets/js/59.c9912d49.js"><link rel="prefetch" href="/assets/js/6.210e38ca.js"><link rel="prefetch" href="/assets/js/60.b29d00e8.js"><link rel="prefetch" href="/assets/js/61.13ff4966.js"><link rel="prefetch" href="/assets/js/62.8efcf596.js"><link rel="prefetch" href="/assets/js/63.5fa9582a.js"><link rel="prefetch" href="/assets/js/64.bbd14fec.js"><link rel="prefetch" href="/assets/js/65.bae7fd4f.js"><link rel="prefetch" href="/assets/js/66.8e3958d7.js"><link rel="prefetch" href="/assets/js/67.dac9beaa.js"><link rel="prefetch" href="/assets/js/68.1c7432eb.js"><link rel="prefetch" href="/assets/js/69.363a3505.js"><link rel="prefetch" href="/assets/js/7.1b6e0d8a.js"><link rel="prefetch" href="/assets/js/70.e4e45ab1.js"><link rel="prefetch" href="/assets/js/71.e941d084.js"><link rel="prefetch" href="/assets/js/72.6c657f6c.js"><link rel="prefetch" href="/assets/js/73.910ec668.js"><link rel="prefetch" href="/assets/js/74.92f12f63.js"><link rel="prefetch" href="/assets/js/75.984c2f19.js"><link rel="prefetch" href="/assets/js/76.e4dddf5f.js"><link rel="prefetch" href="/assets/js/77.1304118a.js"><link rel="prefetch" href="/assets/js/78.36d67468.js"><link rel="prefetch" href="/assets/js/79.bebe2f90.js"><link rel="prefetch" href="/assets/js/8.23102c69.js"><link rel="prefetch" href="/assets/js/80.4f2da588.js"><link rel="prefetch" href="/assets/js/81.666e12e9.js"><link rel="prefetch" href="/assets/js/82.00e1d25e.js"><link rel="prefetch" href="/assets/js/83.6f17555a.js"><link rel="prefetch" href="/assets/js/84.71aca979.js"><link rel="prefetch" href="/assets/js/85.5da240e9.js"><link rel="prefetch" href="/assets/js/86.e9b29015.js"><link rel="prefetch" href="/assets/js/87.0c138ef2.js"><link rel="prefetch" href="/assets/js/88.d122fecd.js"><link rel="prefetch" href="/assets/js/89.ccb42cfb.js"><link rel="prefetch" href="/assets/js/9.7477a4ab.js"><link rel="prefetch" href="/assets/js/90.620b4440.js"><link rel="prefetch" href="/assets/js/91.a231af75.js"><link rel="prefetch" href="/assets/js/92.0bb536ea.js"><link rel="prefetch" href="/assets/js/93.a8d3b09d.js"><link rel="prefetch" href="/assets/js/94.4e3d0336.js"><link rel="prefetch" href="/assets/js/95.263fdc93.js"><link rel="prefetch" href="/assets/js/96.2886b194.js"><link rel="prefetch" href="/assets/js/97.d085eef0.js"><link rel="prefetch" href="/assets/js/98.eaf95a18.js"><link rel="prefetch" href="/assets/js/99.fbafbf7d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3e1d0bd1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">技术博客文章总结</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端三剑客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/CSS/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/" class="nav-link">JavaScript</a></li></ul></div></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue.js</a></div> <a href="https://github.com/tangmengcheng/technology.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端三剑客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/CSS/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/" class="nav-link">JavaScript</a></li></ul></div></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue.js</a></div> <a href="https://github.com/tangmengcheng/technology.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Vue 全家桶</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>React 全家桶</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>TS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ES6+</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>H5</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS3</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>jQuery</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>前端设计模式</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>面试总结</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>高级进阶</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/chapter13/" class="sidebar-link">前端进阶总结</a></li><li><a href="/chapter13/vue.html" class="sidebar-link">vue 深入系列</a></li><li><a href="/chapter13/react.html" class="sidebar-link">react 深入系列</a></li><li><a href="/chapter13/node.html" class="sidebar-link">node 深入系列</a></li><li><a href="/chapter13/webpack.html" class="active sidebar-link">webpack 深入系列</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapter13/webpack.html#常见配置" class="sidebar-link">常见配置</a></li><li class="sidebar-sub-header"><a href="/chapter13/webpack.html#高级配置" class="sidebar-link">高级配置</a></li><li class="sidebar-sub-header"><a href="/chapter13/webpack.html#优化策略" class="sidebar-link">优化策略</a></li><li class="sidebar-sub-header"><a href="/chapter13/webpack.html#ast-抽象语法树" class="sidebar-link">AST 抽象语法树</a></li><li class="sidebar-sub-header"><a href="/chapter13/webpack.html#tapable" class="sidebar-link">Tapable</a></li><li class="sidebar-sub-header"><a href="/chapter13/webpack.html#webpack-的流程" class="sidebar-link">webpack 的流程</a></li><li class="sidebar-sub-header"><a href="/chapter13/webpack.html#手写-loader" class="sidebar-link">手写 loader</a></li><li class="sidebar-sub-header"><a href="/chapter13/webpack.html#手写-plugin" class="sidebar-link">手写 plugin</a></li><li class="sidebar-sub-header"><a href="/chapter13/webpack.html#优化" class="sidebar-link">优化</a></li><li class="sidebar-sub-header"><a href="/chapter13/webpack.html#如何设置环境变量" class="sidebar-link">如何设置环境变量</a></li></ul></li><li><a href="/chapter13/uni-app.html" class="sidebar-link">uni-app 深入系列</a></li><li><a href="/chapter13/mvvm.html" class="sidebar-link">MVVM 框架的实现原理</a></li><li><a href="/chapter13/vue-router.html" class="sidebar-link">Vue-Router 实现原理</a></li><li><a href="/chapter13/virtual-dom.html" class="sidebar-link">Virtual Dom 实现原理</a></li><li><a href="/chapter13/data-construct.html" class="sidebar-link">团队规范</a></li><li><a href="/chapter13/git.html" class="sidebar-link">Git 相关操作</a></li><li><a href="/chapter13/module.html" class="sidebar-link">前端模块化</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>项目</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>源码手写</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>高级面试题汇总</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="webpack-深入系列"><a href="#webpack-深入系列" aria-hidden="true" class="header-anchor">#</a> webpack 深入系列</h1> <blockquote><p>利用 webpack 可以做哪些事情？</p></blockquote> <ol><li>代码转换</li> <li>文件优化</li> <li>代码分割</li> <li>模块合并</li> <li>自动刷新</li> <li>代码校验</li> <li>自动发布
...</li></ol> <h2 id="常见配置"><a href="#常见配置" aria-hidden="true" class="header-anchor">#</a> 常见配置</h2> <div class="language-sh extra-class"><pre class="language-text"><code>npm install webpack webpack-cli -D
</code></pre></div><p><strong>扩展</strong>：</p> <ol><li><code>-D</code> 等价于 <code>--save-dev</code>, 用于开发环境时的依赖</li> <li><code>-S</code> 等价于 <code>--save</code>, 用于生产环境时的依赖</li></ol> <ul><li>指定配置文件</li></ul> <div class="language-sh extra-class"><pre class="language-text"><code>npx webpack --config 自定义名称
</code></pre></div><ul><li>开发服务器</li></ul> <div class="language-sh extra-class"><pre class="language-text"><code>npm install webpack-dev-server -D

devServer: { // 开发服务器的配置
   port: 3000, // 指定端口
   progress: true, // 开启进度条
   contentBase: './dist', // 指定静态服务的目录
   open: true, // 自动打开网页
   compress: true, // 启动gzip压缩
}
</code></pre></div><ul><li><p>模块</p> <p>loader 特点：希望单一，每个 loader 做对应的事情</p> <p>loader 的用法：字符串只用一个 loader, 多个 loader 需要[]</p> <p>loader 的顺序：从右向左执行, 从下到上执行</p> <p>loader 还可以写成对象的形式</p></li></ul> <ol><li>style-loader: 是把 css 插入到 head 标签中</li> <li>css-loader: 解析 @import 语法</li> <li>less-loader: 把.less 文件转换为.css 文件</li> <li>stylus-loader: 把.styl 文件转换为.styl 文件</li> <li>sass-loader: 把.scss 文件转换为.scss 文件</li> <li>postcss-loader: 一般配合 autoprefixer 一起使用，添加浏览器前缀</li></ol> <ul><li>插件</li></ul> <ol><li>html-webpack-plugin</li></ol> <div class="language-sh extra-class"><pre class="language-text"><code>npm install html-webpack-plugin -D
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  template<span class="token punctuation">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">,</span> <span class="token comment">// 以哪个html文件作为模板</span>
  filename<span class="token punctuation">:</span> <span class="token string">'tmc.html'</span><span class="token punctuation">,</span> <span class="token comment">// 指定模板的名称,</span>
  minify<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    removeAttributeQuotes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 删除双引号</span>
    collapseWhitespace<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 压缩为一行</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  hash<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// hash 值</span>
  title<span class="token punctuation">:</span> <span class="token string">'汤小梦'</span><span class="token punctuation">,</span> <span class="token comment">// 设置网站标题</span>
  favicon<span class="token punctuation">:</span> <span class="token string">'./src/public/favicon.ico'</span><span class="token punctuation">,</span> <span class="token comment">// 设置网站的 icon 图</span>
  inject<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token operator">|</span> <span class="token string">'head'</span> <span class="token operator">|</span> <span class="token string">'body'</span> <span class="token operator">|</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 设置为 true 或 body，所有的 javascript 资源将被放置到 body 元素的底部，'head' 或 false 将放置到 head 元素中</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>注意</strong>：动态设置 title 时，需在模板的<code>&lt;title&gt;</code>标签中添加 <code>&lt;%= htmlWebpackPlugin.options.title %&gt;</code></p> <ol start="2"><li>mini-css-extract-plugin</li></ol> <div class="language-sh extra-class"><pre class="language-text"><code>npm install mini-css-extract-plugin -D
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  filename<span class="token punctuation">:</span> <span class="token string">'css/index.css'</span><span class="token punctuation">,</span> <span class="token comment">// 输出的文件名</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 使用</span>
style<span class="token operator">-</span>loader <span class="token operator">==</span><span class="token operator">&gt;</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader
</code></pre></div><ol start="3"><li>optimize-css-assets-webpack-plugin</li></ol> <div class="language-sh extra-class"><pre class="language-text"><code>npm install optimize-css-assets-webpack-plugin -D
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">// 优化项</span>
    minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 压缩打包过后的CSS</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ol start="4"><li>uglifyjs-webpack-plugin</li></ol> <div class="language-sh extra-class"><pre class="language-text"><code>npm install uglifyjs-webpack-plugin -D 【弃用】
npm install terser-webpack-plugin -D
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">// 优化项</span>
  minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 压缩打包过后的JS</span>
          cache<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 启动缓存</span>
          parallel<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 并发压缩</span>
          sourceMap<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// 启动源码调试</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p><strong>注意</strong>：uglify-js 只支持压缩 ES5，uglify-es 用来支持 es6+，之后放弃维护了。如果要使用 uglify-js 压缩 ES6+需要先使用 babel 转码成 ES5. 取代 ugligy-es 的是 uglify-es 的一个分支 terser; webpack 放弃了 <code>uglifyjs-webpack-plugin</code> 转而使用 <code>terser-webpack-plugin</code>;</p> <h2 id="高级配置"><a href="#高级配置" aria-hidden="true" class="header-anchor">#</a> 高级配置</h2> <h2 id="优化策略"><a href="#优化策略" aria-hidden="true" class="header-anchor">#</a> 优化策略</h2> <h2 id="ast-抽象语法树"><a href="#ast-抽象语法树" aria-hidden="true" class="header-anchor">#</a> AST 抽象语法树</h2> <h2 id="tapable"><a href="#tapable" aria-hidden="true" class="header-anchor">#</a> Tapable</h2> <h2 id="webpack-的流程"><a href="#webpack-的流程" aria-hidden="true" class="header-anchor">#</a> webpack 的流程</h2> <h2 id="手写-loader"><a href="#手写-loader" aria-hidden="true" class="header-anchor">#</a> 手写 loader</h2> <h3 id="什么是-loader"><a href="#什么是-loader" aria-hidden="true" class="header-anchor">#</a> 什么是 Loader</h3> <p>Webpack 只能处理 JavaScript 的模块，如果要处理其他类型的文件，需要使用 loader 进行准转换。它是指用来将一段代码转换成另一段代码的 webpack 加载器. loader 由两部分组成，一分部是 pitchLoader, 另一部分是 normalLoader. pitchLoader 和 normalLoader 执行顺序相反. pitchLoader 中有返回值就直接不走后面的了.</p> <ul><li><p>loader 的顺序</p> <p>从右向左，从下到上</p></li> <li><p>loader 的使用方式</p> <ol><li>单个 loader 可以写成字符串也可以写成对象</li> <li>多个 loader 写成数组</li></ol></li> <li><p>loader 的特点</p> <ol><li>第一个 loader 要返回一个 js 脚本. (默认只能接受 String Or Buffer)</li> <li>每个 loader 只能做一件事，为了 loader 再更多场景下链式调用</li> <li>么讴歌 loader 都是一个模块</li> <li>每个 loader 都是<strong>无状态的</strong>, 确保 loader 在不同模块转换直接不保存状态</li></ol></li> <li><p>loader 的分类</p> <ol><li>pre 在前面的</li> <li>post 在后面的</li> <li>normal 正常的</li></ol> <p>行内 loader 的用法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 符号的含义</span>
<span class="token comment">// -! 不会让文件 去通过 pre + normal loader来处理了</span>
<span class="token comment">// ! 没有normal</span>
<span class="token comment">// !! 什么都不要 只要inline-loader</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inline-loader!./xx.js'</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>顺序</strong>：pre -&gt; normal -&gt; inline -&gt; post</p></li> <li><p>查找 loader 的几种方式</p> <ol><li>绝对路径</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>use<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'loader.js'</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>设置别名</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>resolveLoader<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    loader<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'loader.js'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

use<span class="token punctuation">:</span> loader
</code></pre></div><ol start="3"><li>自动查找</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>resolveLoader<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// 默认在node_modules下查找，找不到就自动到loaders目录下查找</span>
  modules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'loaders'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>babel-loader 的实现</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/core'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(this.resourcePath) 绝对路径 this loader上下文</span>
  <span class="token keyword">let</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> cb <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>
    source<span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token operator">...</span>options<span class="token punctuation">,</span>
      sourceMaps<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      filename<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourcePath<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">.</span>code<span class="token punctuation">,</span> result<span class="token punctuation">.</span>map<span class="token punctuation">)</span> <span class="token comment">// 异步</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader
</code></pre></div><h2 id="手写-plugin"><a href="#手写-plugin" aria-hidden="true" class="header-anchor">#</a> 手写 plugin</h2> <h2 id="优化"><a href="#优化" aria-hidden="true" class="header-anchor">#</a> 优化</h2> <blockquote><p>打包的数据分析</p></blockquote> <div class="language-sh extra-class"><pre class="language-text"><code>npm install friendly-errors-webpack-plugin node-notifier -D
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> FriendlyErrorsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'friendly-errors-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> notifier <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-notifier'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> icon <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'icon.jpg'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">onErrors</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">severity<span class="token punctuation">,</span> errors</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> error <span class="token operator">=</span> errors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        notifier<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          title<span class="token punctuation">:</span> <span class="token string">'webpack编译失败'</span><span class="token punctuation">,</span>
          message<span class="token punctuation">:</span> error<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
          subscribe<span class="token punctuation">:</span> error<span class="token punctuation">.</span>file <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
          icon<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-sh extra-class"><pre class="language-text"><code>npm install speed-measure-webpack-plugin -D // 适用于 webpack4
npm install speed-measure-webpack5-plugin -D // 适用于 webpack5
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> SpeedMeasureWebpack5Plugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'speed-measure-webpack5-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> smw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasureWebpack5Plugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smw<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-sh extra-class"><pre class="language-text"><code>npm install webpack-bundle-analyzer -D
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> BundleAnalyzerPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smw<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      analyzerMode<span class="token punctuation">:</span> <span class="token string">'disabled'</span><span class="token punctuation">,</span> <span class="token comment">// 不启动展示打包报告的HTTP服务器</span>
      generateStatsFile<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 要生成stats.json文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>编译时间的优化: 减少要处理的文件、缩小查找的范围</p></blockquote> <blockquote><p>编译体积优化</p></blockquote> <h2 id="如何设置环境变量"><a href="#如何设置环境变量" aria-hidden="true" class="header-anchor">#</a> 如何设置环境变量</h2> <blockquote><p>mode 的默认值</p></blockquote> <ol><li>webpack 的 mode 默认值为 production</li> <li>webpack serve 的 默认值为 development</li> <li>可以在模块内通过 process.env.NODE_ENV 获取当前的环境变量，无法在 webpack 配置文件中获取此变量</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'webpack  process.env.NODE_ENV'</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span> <span class="token comment">// node环境 默认值是undefined</span>

<span class="token comment">// src/index.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'src/index.js process.env.NODE_ENV'</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span> <span class="token comment">// production</span>
</code></pre></div><blockquote><p>设置 mode 值的方式</p></blockquote> <ol><li>命令行 mode 方式</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.json</span>
<span class="token string">&quot;build&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack --mode development&quot;</span>
</code></pre></div><ol start="2"><li>命令行 env 方式</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.json</span>
<span class="token string">&quot;build&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack --env development&quot;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span> env <span class="token operator">==</span> <span class="token string">'development'</span> <span class="token operator">?</span> <span class="token string">'development'</span> <span class="token punctuation">:</span> <span class="token string">'production'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>DefinePlugin 方式</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token constant">ENV</span><span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'development'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>注意</strong>：该全局变量定义在 <strong>编译</strong> 时的，在浏览器 <strong>运行</strong> 阶段就是值了访问不到了</p> <ol start="4"><li>cross-env 方式</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;build&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;cross-env NODE_ENV=development webpack&quot;</span>
</code></pre></div><ol start="5"><li>创建 .env 和 dotenv 方式</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .env</span>
<span class="token constant">NODE_ENV</span> <span class="token operator">=</span> production

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dotenv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>preload vs prefetch</p> <ol><li>preload 是告诉浏览器页面必定需要的资源，浏览器一定会加载这些资源</li> <li>而 prefetch 是告诉浏览器页面可能需要的资源，浏览器不一定会加载这些资源
所以建议：对于当前页面很有必要的资源使用 preload，对于可能在将来的页面中使用的资源使用 prefetch</li></ol></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/chapter13/node.html" class="prev">
          node 深入系列
        </a></span> <span class="next"><a href="/chapter13/uni-app.html">
          uni-app 深入系列
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.c45b4ff4.js" defer></script><script src="/assets/js/44.11b7ef0a.js" defer></script>
  </body>
</html>
