<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1. JSBridge 通信？ | 技术博客文章总结</title>
    <meta name="description" content="Welcome to come to my blog">
    
    
    <link rel="preload" href="/assets/css/0.styles.3e1d0bd1.css" as="style"><link rel="preload" href="/assets/js/app.c45b4ff4.js" as="script"><link rel="preload" href="/assets/js/74.92f12f63.js" as="script"><link rel="prefetch" href="/assets/js/10.9cdf722f.js"><link rel="prefetch" href="/assets/js/100.9b45b75e.js"><link rel="prefetch" href="/assets/js/101.95c4d653.js"><link rel="prefetch" href="/assets/js/102.09cdc274.js"><link rel="prefetch" href="/assets/js/103.985d4863.js"><link rel="prefetch" href="/assets/js/104.66cfb550.js"><link rel="prefetch" href="/assets/js/105.78c4c309.js"><link rel="prefetch" href="/assets/js/106.34be9d25.js"><link rel="prefetch" href="/assets/js/107.0df352d3.js"><link rel="prefetch" href="/assets/js/108.901d6014.js"><link rel="prefetch" href="/assets/js/109.76339f5d.js"><link rel="prefetch" href="/assets/js/11.d22cc24d.js"><link rel="prefetch" href="/assets/js/110.c6e9ec88.js"><link rel="prefetch" href="/assets/js/111.d390a797.js"><link rel="prefetch" href="/assets/js/112.cf502784.js"><link rel="prefetch" href="/assets/js/113.aa449169.js"><link rel="prefetch" href="/assets/js/114.fc2133ce.js"><link rel="prefetch" href="/assets/js/115.523542e3.js"><link rel="prefetch" href="/assets/js/116.c3507815.js"><link rel="prefetch" href="/assets/js/117.23b5b1f0.js"><link rel="prefetch" href="/assets/js/118.5df8c262.js"><link rel="prefetch" href="/assets/js/119.8e1342c2.js"><link rel="prefetch" href="/assets/js/12.636890c7.js"><link rel="prefetch" href="/assets/js/120.01f21153.js"><link rel="prefetch" href="/assets/js/121.7b546d27.js"><link rel="prefetch" href="/assets/js/122.bd8c0286.js"><link rel="prefetch" href="/assets/js/123.f4f16ed2.js"><link rel="prefetch" href="/assets/js/124.ab5935d4.js"><link rel="prefetch" href="/assets/js/125.b29cf321.js"><link rel="prefetch" href="/assets/js/126.ddf1b9eb.js"><link rel="prefetch" href="/assets/js/127.4d63b823.js"><link rel="prefetch" href="/assets/js/128.f63c61cb.js"><link rel="prefetch" href="/assets/js/129.e74fb4b4.js"><link rel="prefetch" href="/assets/js/13.74a454d8.js"><link rel="prefetch" href="/assets/js/130.05f02f04.js"><link rel="prefetch" href="/assets/js/131.bac5f9b9.js"><link rel="prefetch" href="/assets/js/132.a98fffcf.js"><link rel="prefetch" href="/assets/js/133.5b34ebb6.js"><link rel="prefetch" href="/assets/js/14.ffe8d211.js"><link rel="prefetch" href="/assets/js/15.1bcc034f.js"><link rel="prefetch" href="/assets/js/16.87d6c8f3.js"><link rel="prefetch" href="/assets/js/17.576aa97e.js"><link rel="prefetch" href="/assets/js/18.8c80ffa6.js"><link rel="prefetch" href="/assets/js/19.bd2abc77.js"><link rel="prefetch" href="/assets/js/2.0379b669.js"><link rel="prefetch" href="/assets/js/20.56b31195.js"><link rel="prefetch" href="/assets/js/21.81d1d011.js"><link rel="prefetch" href="/assets/js/22.b52a1bed.js"><link rel="prefetch" href="/assets/js/23.76785e7d.js"><link rel="prefetch" href="/assets/js/24.4bcce340.js"><link rel="prefetch" href="/assets/js/25.b2de599f.js"><link rel="prefetch" href="/assets/js/26.944ed78e.js"><link rel="prefetch" href="/assets/js/27.0bbcee1a.js"><link rel="prefetch" href="/assets/js/28.223ed5b6.js"><link rel="prefetch" href="/assets/js/29.b88c0c25.js"><link rel="prefetch" href="/assets/js/3.b3231975.js"><link rel="prefetch" href="/assets/js/30.5754e2d0.js"><link rel="prefetch" href="/assets/js/31.038ca76a.js"><link rel="prefetch" href="/assets/js/32.7f0c55a6.js"><link rel="prefetch" href="/assets/js/33.7fd80664.js"><link rel="prefetch" href="/assets/js/34.8dcb3109.js"><link rel="prefetch" href="/assets/js/35.8b1fdc43.js"><link rel="prefetch" href="/assets/js/36.cf886fc0.js"><link rel="prefetch" href="/assets/js/37.f7abfe5d.js"><link rel="prefetch" href="/assets/js/38.f63c0deb.js"><link rel="prefetch" href="/assets/js/39.9b06b340.js"><link rel="prefetch" href="/assets/js/4.c1de1412.js"><link rel="prefetch" href="/assets/js/40.490eed30.js"><link rel="prefetch" href="/assets/js/41.b5abbdbc.js"><link rel="prefetch" href="/assets/js/42.1f6e4a3a.js"><link rel="prefetch" href="/assets/js/43.5e85acae.js"><link rel="prefetch" href="/assets/js/44.11b7ef0a.js"><link rel="prefetch" href="/assets/js/45.9774ff29.js"><link rel="prefetch" href="/assets/js/46.2cf4bc5b.js"><link rel="prefetch" href="/assets/js/47.bc79b4ef.js"><link rel="prefetch" href="/assets/js/48.0d80c17f.js"><link rel="prefetch" href="/assets/js/49.4fcabf82.js"><link rel="prefetch" href="/assets/js/5.1d97952d.js"><link rel="prefetch" href="/assets/js/50.7d65f488.js"><link rel="prefetch" href="/assets/js/51.2545cb57.js"><link rel="prefetch" href="/assets/js/52.36a2cca1.js"><link rel="prefetch" href="/assets/js/53.64484c50.js"><link rel="prefetch" href="/assets/js/54.52e5411a.js"><link rel="prefetch" href="/assets/js/55.4f773e83.js"><link rel="prefetch" href="/assets/js/56.a5437204.js"><link rel="prefetch" href="/assets/js/57.24dd7861.js"><link rel="prefetch" href="/assets/js/58.86388619.js"><link rel="prefetch" href="/assets/js/59.c9912d49.js"><link rel="prefetch" href="/assets/js/6.210e38ca.js"><link rel="prefetch" href="/assets/js/60.b29d00e8.js"><link rel="prefetch" href="/assets/js/61.13ff4966.js"><link rel="prefetch" href="/assets/js/62.8efcf596.js"><link rel="prefetch" href="/assets/js/63.5fa9582a.js"><link rel="prefetch" href="/assets/js/64.bbd14fec.js"><link rel="prefetch" href="/assets/js/65.bae7fd4f.js"><link rel="prefetch" href="/assets/js/66.8e3958d7.js"><link rel="prefetch" href="/assets/js/67.dac9beaa.js"><link rel="prefetch" href="/assets/js/68.1c7432eb.js"><link rel="prefetch" href="/assets/js/69.363a3505.js"><link rel="prefetch" href="/assets/js/7.1b6e0d8a.js"><link rel="prefetch" href="/assets/js/70.e4e45ab1.js"><link rel="prefetch" href="/assets/js/71.e941d084.js"><link rel="prefetch" href="/assets/js/72.6c657f6c.js"><link rel="prefetch" href="/assets/js/73.910ec668.js"><link rel="prefetch" href="/assets/js/75.984c2f19.js"><link rel="prefetch" href="/assets/js/76.e4dddf5f.js"><link rel="prefetch" href="/assets/js/77.1304118a.js"><link rel="prefetch" href="/assets/js/78.36d67468.js"><link rel="prefetch" href="/assets/js/79.bebe2f90.js"><link rel="prefetch" href="/assets/js/8.23102c69.js"><link rel="prefetch" href="/assets/js/80.4f2da588.js"><link rel="prefetch" href="/assets/js/81.666e12e9.js"><link rel="prefetch" href="/assets/js/82.00e1d25e.js"><link rel="prefetch" href="/assets/js/83.6f17555a.js"><link rel="prefetch" href="/assets/js/84.71aca979.js"><link rel="prefetch" href="/assets/js/85.5da240e9.js"><link rel="prefetch" href="/assets/js/86.e9b29015.js"><link rel="prefetch" href="/assets/js/87.0c138ef2.js"><link rel="prefetch" href="/assets/js/88.d122fecd.js"><link rel="prefetch" href="/assets/js/89.ccb42cfb.js"><link rel="prefetch" href="/assets/js/9.7477a4ab.js"><link rel="prefetch" href="/assets/js/90.620b4440.js"><link rel="prefetch" href="/assets/js/91.a231af75.js"><link rel="prefetch" href="/assets/js/92.0bb536ea.js"><link rel="prefetch" href="/assets/js/93.a8d3b09d.js"><link rel="prefetch" href="/assets/js/94.4e3d0336.js"><link rel="prefetch" href="/assets/js/95.263fdc93.js"><link rel="prefetch" href="/assets/js/96.2886b194.js"><link rel="prefetch" href="/assets/js/97.d085eef0.js"><link rel="prefetch" href="/assets/js/98.eaf95a18.js"><link rel="prefetch" href="/assets/js/99.fbafbf7d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3e1d0bd1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">技术博客文章总结</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端三剑客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/CSS/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/" class="nav-link">JavaScript</a></li></ul></div></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue.js</a></div> <a href="https://github.com/tangmengcheng/technology.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端三剑客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/CSS/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/" class="nav-link">JavaScript</a></li></ul></div></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue.js</a></div> <a href="https://github.com/tangmengcheng/technology.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Vue 全家桶</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>React 全家桶</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>TS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ES6+</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>H5</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS3</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>jQuery</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>前端设计模式</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>面试总结</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>高级进阶</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>项目</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>源码手写</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>高级面试题汇总</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/chapter16/" class="sidebar-link">前端面试大纲</a></li><li><a href="/chapter16/html.html" class="sidebar-link">HTML 部分</a></li><li><a href="/chapter16/css.html" class="sidebar-link">CSS 部分</a></li><li><a href="/chapter16/js.html" class="sidebar-link">JS 部分</a></li><li><a href="/chapter16/vue.html" class="sidebar-link">Vue 部分</a></li><li><a href="/chapter16/react.html" class="sidebar-link">React 部分</a></li><li><a href="/chapter16/webpack.html" class="sidebar-link">Webpack 部分</a></li><li><a href="/chapter16/http.html" class="sidebar-link">HTTP 部分</a></li><li><a href="/chapter16/algorithm.html" class="sidebar-link">算法部分</a></li><li><a href="/chapter16/optimize.html" class="sidebar-link">优化部分</a></li><li><a href="/chapter16/performance.html" class="active sidebar-link">开放性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_1-jsbridge-通信？" class="sidebar-link">1. JSBridge 通信？</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_2-小程序-与-vue-有什么区别？" class="sidebar-link">2. 小程序 与 Vue 有什么区别？</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_3-团队的开发流程？" class="sidebar-link">3. 团队的开发流程？</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_4-如何防止首页白屏？" class="sidebar-link">4. 如何防止首页白屏？</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_5-怎么理解前端工程化、模块化、组件化" class="sidebar-link">5. 怎么理解前端工程化、模块化、组件化?</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_6-微前端中的渲染、js-沙箱、样式隔离、数据通信" class="sidebar-link">6. 微前端中的渲染、JS 沙箱、样式隔离、数据通信?</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_7-如何实现扫码登录功能？" class="sidebar-link">7. 如何实现扫码登录功能？</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_8-如何防止重复发送请求？" class="sidebar-link">8. 如何防止重复发送请求？</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_9-实现一个页面操作不会整页刷新的网站" class="sidebar-link">9. 实现一个页面操作不会整页刷新的网站</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_10、如何优化单页面首屏加载白屏体验或加重速度慢问题-？" class="sidebar-link">10、如何优化单页面首屏加载白屏体验或加重速度慢问题 ？</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_11-如何设计一个-vue-组件？" class="sidebar-link">11. 如何设计一个 Vue 组件？</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_12-如何开发一个开源组件库？" class="sidebar-link">12. 如何开发一个开源组件库？</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_13-如何统一对错误进行捕获的？" class="sidebar-link">13. 如何统一对错误进行捕获的？</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_14-vue-的异步错误如何捕获？" class="sidebar-link">14. vue 的异步错误如何捕获？</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_15-如如何用鉴权控制登陆时间设计保持七天登录状态？" class="sidebar-link">15. 如如何用鉴权控制登陆时间设计保持七天登录状态？</a></li><li class="sidebar-sub-header"><a href="/chapter16/performance.html#_16-为什么-b-站的弹幕可以不挡人物" class="sidebar-link">16. 为什么 B 站的弹幕可以不挡人物?</a></li></ul></li><li><a href="/chapter16/inter.html" class="sidebar-link">2022</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h2 id="_1-jsbridge-通信？"><a href="#_1-jsbridge-通信？" aria-hidden="true" class="header-anchor">#</a> 1. JSBridge 通信？</h2> <p>主要是给 <code>JavaScript</code> 提供调用 <code>Native 功能</code>的接口，让混合开发中的前端部分可以方便地使用 <code>Native</code> 的功能（例如：<code>地址位置</code>、<code>摄像头</code>）。是 <code>Native</code> 和 <code>非 Native</code> 之间的桥梁，它的核心是构建 <code>Native</code> 和 <code>非 Native</code> 间 <strong>消息通信的通道</strong> ，而且这个通信的通道是<strong>双向的</strong>。</p> <ul><li><p><code>JSBridge</code> 的通信原理</p> <ol><li><p><code>JavaScript</code> 调用 <code>Native</code> 的方式: 主要有<strong>两种</strong>：<code>注入API</code> 和 <code>拦截URL SCHEME</code></p> <ul><li><p><strong>注入 API</strong> 方式的主要原理是，通过 <code>WebView</code> 提供的接口，向 <code>JavaScript</code> 的 <code>Context（window）</code>中注入对象或者方法，让 <code>JavaScript</code> 调用时，直接执行相应的 <code>Native 代码</code> 逻辑，达到 <code>JavaScript</code> 调用 <code>Native</code> 的目的</p></li> <li><p><strong>拦截 URL SCHEME</strong> 的主要流程是：<code>Web 端</code> 通过某种方式（例如 <code>iframe.src</code>）发送 <code>URL Scheme</code> 请求，之后 <code>Native</code> 拦截到请求并根据 <code>URL SCHEME</code>（包括所带的参数）进行相关操作</p> <p>在时间过程中，这种方式有一定的<strong>缺陷</strong>：</p> <ol><li>使用 <code>iframe.src</code> 发送 <code>URL SCHEME</code> 会有 <code>url 长度</code>的隐患。</li> <li>创建请求，需要一定的耗时，比注入 API 的方式调用同样的功能，耗时会较长</li></ol></li></ul> <p><strong>因此</strong>：<code>JavaScript</code> 调用 <code>Native</code> 推荐使用: <strong>注入 API</strong> 的方式</p></li> <li><p><code>Native</code> 调用 <code>JavaScript</code> 的方式</p> <p>相比于 <code>JavaScript</code> 调用 <code>Native</code>， <code>Native</code> 调用 JavaScript<code>较为简单，直接执行拼接好的</code>JavaScript 代码<code>即可。从外部调用</code>JavaScript<code>中的方法，因此</code>JavaScript<code>的方法必须在全局的</code>window` 上。</p></li></ol></li></ul> <p><strong>扩展</strong>：<code>RN</code> 与 <code>webView</code> 的通信</p> <ul><li><p><code>webview</code> 中点击事件代码</p> <p>通过 <code>postMessage()</code>方法，传递 <code>两个参数</code>。一个是 <code>type 值</code>，是我们做判断时候用的。判断是哪种类型的消息。另一个是我们想传递的 <code>其他参数</code>。这里记得参数传递前做一次：<code>JSON.stringify()</code>方法，解析 <code>json 字符串</code></p></li> <li><p><code>RN</code> 中获取传过来的参数
<code>Webview</code> 组件的 <code>onMessage</code> 方法中接受：<code>JSON.parse(event.nativeEvent.data)</code></p></li></ul> <h2 id="_2-小程序-与-vue-有什么区别？"><a href="#_2-小程序-与-vue-有什么区别？" aria-hidden="true" class="header-anchor">#</a> 2. 小程序 与 Vue 有什么区别？</h2> <ul><li><p><strong>生命周期</strong>：相比之下，小程序的钩子函数要简单得多。vue 的钩子函数在跳转新页面时，钩子函数都会触发，但是小程序的钩子函数，页面不同的跳转方式，触发的钩子并不一样</p> <ol><li><p><strong>onLoad</strong>：<code>页面加载</code>: 一个页面只会调用一次，可以在 <code>onLoad</code> 中获取打开当前页面所调用的 <code>query</code> 参数</p></li> <li><p><strong>onShow</strong>: <code>页面显示</code>: 每次打开页面都会调用一次</p></li> <li><p><strong>onReady</strong>: <code>页面初次渲染完成</code>: 一个页面只会调用一次，代表页面已经准备妥当，可以和视图层进行交互。对界面的设置如 <code>wx.setNavigationBarTitle</code> 请在 <code>onReady</code> 之后设置</p></li> <li><p><strong>onHide</strong>: <code>页面隐藏</code>: 当 <code>navigateTo</code> 或底部 <code>tab</code> 切换时调用</p></li> <li><p><strong>onUnload</strong>: <code>页面卸载</code>: 当 <code>redirectTo</code> 或 <code>navigateBack</code> 的时候调用</p></li></ol></li> <li><p><strong>数据请求</strong></p> <p>在页面加载请求数据时，两者钩子的使用有些类似，<code>vue</code> 一般会在 <code>created</code> 或者 <code>mounted</code> 中请求数据。而在小程序，会在 <code>onLoad</code> 或者 <code>onShow</code> 中请求数据</p></li> <li><p><strong>数据绑定</strong></p> <ol><li><p><strong>Vue</strong>: <code>vue</code> 动态绑定一个变量的值为元素的某个属性的时候，会在变量前面加上冒号<code>：</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>imgSrc<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div></li> <li><p><strong>小程序</strong>: 绑定某个变量的值为元素属性时，会用 <code>两个大括号</code> 括起来，如果不加括号，为被认为是 <code>字符串</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{imgSrc}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol></li> <li><p><strong>列表渲染</strong></p> <ol><li><strong>Vue</strong>: <code>&lt;li v-for=&quot;item in items&quot;&gt;&lt;/li&gt;</code></li> <li><strong>小程序</strong>: <code>&lt;text wx:for=&quot;&quot;&gt;&lt;/text&gt;</code></li></ol></li> <li><p><strong>显示与隐藏元素</strong></p> <ol><li><strong>Vue</strong>: 使用 <code>v-if</code> 和 <code>v-show</code> 控制元素的显示和隐藏</li> <li><strong>小程序</strong>: 使用 <code>wx-if</code> 和 <code>hidden</code> 控制元素的显示和隐藏</li></ol></li> <li><p><strong>事件处理</strong></p> <ol><li><p><strong>Vue</strong>: 使用 <code>v-on:event</code> 绑定事件，或者使用<code>@event</code> 绑定事件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>counter += 1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Add 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>counter += 1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Add 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><strong>小程序</strong>: 全用 <code>bindtap(bind+event)</code>，或者 <code>catchtap(catch+event)</code> 绑定事件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>noWork<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>明天不上班<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">catchtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>noWork<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>明天不上班<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol></li> <li><p><strong>数据双向绑定</strong></p> <ol><li><strong>Vue</strong>: 表单元素上加 <code>v-model</code></li> <li><strong>小程序</strong>: 通过监听输入框事件 <code>bindinput</code>,调用 <code>setData({})</code>方法进行模拟</li></ol></li> <li><p><strong>取值</strong></p> <ol><li><strong>Vue</strong>: 通过 <code>this.xxx</code> 取值</li> <li><strong>小程序</strong>: 通过 <code>this.data.xxx</code> 取值</li></ol></li> <li><p><strong>绑定事件传参</strong></p> <ol><li><p><strong>Vue</strong>: 绑定事件传参挺简单，只需要在触发事件的方法中，把需要传递的数据作为形参传入就可以了</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>say('明天不上班')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><strong>小程序</strong>: 不能直接在绑定事件的方法中传入参数，需要将参数作为属性值，绑定到元素上的 <code>data-属性</code> 上，然后在方法中，通过 <code>e.currentTarget.dataset.*</code> 的方式获取</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>tr<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>toApprove<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item.id}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
toApprove(e) { let id = e.currentTarget.dataset.id; }
</code></pre></div></li></ol></li></ul> <blockquote><p>小程序实现原理解析</p></blockquote> <ul><li><p><strong>小程序目录结构</strong></p> <ul><li>一个完整的小程序主要由以下几部分组成：
<ol><li>一个入口文件：<code>app.js</code></li> <li>一个全局样式：<code>app.wxss</code></li> <li>一个全局配置：<code>app.json</code></li></ol></li></ul> <p>页面：<code>pages</code> 下，每个页面再按文件夹划分，每个页面 4 个文件</p> <ol><li>视图：<code>wxml</code>, <code>wxss</code></li> <li>逻辑：<code>js</code>, <code>json</code> (页面配置, 不是必须)</li></ol></li> <li><p><strong>小程序架构</strong></p> <p>微信小程序的框架包含两部分：<code>View视图层</code>、<code>App Service逻辑层</code>. <code>View 层</code> 用来渲染页面结构，<code>AppService 层</code> 用来 <code>逻辑处理</code>、<code>数据请求</code>、<code>接口调用</code>，它们在两个进程（两个 <code>Webview</code>）里运行</p> <p><code>视图层</code> 和 <code>逻辑层</code> 通过系统层的 <strong>JSBridge</strong> 进行通信，<code>逻辑层</code> 把数据变化通知到 <code>视图层</code>，触发视图层页面更新，视图层把触发的事件通知到 <code>逻辑层</code> 进行业务处理
<img src="https://imgconvert.csdnimg.cn/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcwMzI2MjE1NzI0ODkx?x-oss-process=image/format,png" alt></p> <p><strong>扩展</strong>：小程序不允许打开超过 5 个层级的页面？</p> <p>小程序的视图和逻辑处理是用多个 <code>webview</code> 实现的，逻辑处理的 <code>JS 代码</code>全部加载到一个 <code>Webview</code> 里面，称之为 <code>AppService</code>，整个小程序只有一个，并且整个生命周期常驻内存。而所有的视图（<code>wxml</code> 和 <code>wxss</code>）都是单独的 <code>Webview</code> 来承载，称之为 <code>AppView</code>。所以一个小程序打开<strong>至少就会有 2 个 webview 进程</strong>，正式因为每个视图都是一个独立的 <code>webview</code> 进程，考虑到性能消耗</p> <p><strong>原理上</strong>，<code>微信 App</code> 里包含 <code>javascript 运行引擎</code>、<code>WXML/WXSS 处理引擎</code>，最终会把界面翻译成系统原生的界面，并展示出来。这样做的目的是为了提供和原生 App 性能相当的用户体验。</p> <ul><li>在 <code>ios</code> 中，小程序的 <code>javascript</code> 运行在 <code>javascriptCore</code> 中</li> <li>在 <code>Android</code> 中,小程序的 <code>javascript</code> 是通过 <code>X5 内核</code> 来解析的</li></ul></li></ul> <blockquote><p>小程序的优劣势</p></blockquote> <ul><li><strong>优势</strong>：
<ol><li>无需下载，通过搜索和扫一扫就可以打开</li> <li>良好的用户体验：打开速度快</li> <li>开发成本要比 App 要低</li> <li>安卓上可以添加到桌面，与原生 App 差不多</li> <li>为用户提供良好的安全保障。小程序的发布，微信拥有一套严格的审查流程， 不能通过审查的小程序是无法发布到线上的</li></ol></li> <li>劣势：
<ol><li><strong>限制较多</strong>: 页面大小不能超过 <code>1M</code>。不能打开超过 <code>5 个层级</code> 的页面</li> <li><strong>样式单一</strong>: 小程序的部分组件已经是成型的了，样式不可以修改。例如：幻灯片、导航</li> <li><strong>推广面窄</strong>: 不能分享朋友圈，只能通过分享给朋友，附近小程序推广。其中附近小程序也受到微信的限制</li> <li><strong>依托于微信</strong>: 无法开发后台管理功能</li></ol></li></ul> <h3 id="提高微信小程序的应用速度的手段有哪些？"><a href="#提高微信小程序的应用速度的手段有哪些？" aria-hidden="true" class="header-anchor">#</a> 提高微信小程序的应用速度的手段有哪些？</h3> <p>小程序首次启动前，<code>微信会在小程序启动前为小程序准备好通用的运行环境</code>，如运行中的线程和一些基础库的初始化。然后才开始进入启动状态，展示一个固定的启动界面，界面内包含小程序的图标、名称和加载提示图标。此时，微信会在背后完成几项工作：</p> <ol><li><code>下载</code> 小程序代码包</li> <li><code>加载</code> 小程序代码包</li> <li><code>初始化</code> 小程序首页</li></ol> <p><strong>注意</strong>：下载到的小程序代码包不是<code>小程序的源代码</code>，而是<code>编译、压缩、打包</code>之后的代码包</p> <p><img src="https://img-blog.csdnimg.cn/img_convert/f2d05af7f83f5cd6b9e9bbc66e459e8d.png" alt></p> <p>围绕上图小程序的启动流程， 提高速度我们可以从<code>加载</code>、<code>渲染</code>两个纬度进行切入：</p> <ul><li>小程序启动加载性能：
<ol><li>控制代码包的大小</li> <li>分包加载</li> <li>首屏体验（预请求，利用缓存，避免白屏）</li></ol></li> <li>小程序渲染性能
<ol><li>不要过于频繁调用 <code>setData</code>，应考虑将多次 <code>setData</code> 合并成一次 <code>setData</code> 调用</li> <li>与界面渲染无关的数据最好不要设置在 <code>data</code> 中</li> <li>自定义组件（各个组件也将具有各自独立的逻辑空间。分别拥有自己的独立的数据、<code>setData</code> 调用）</li></ol></li></ul> <h2 id="_3-团队的开发流程？"><a href="#_3-团队的开发流程？" aria-hidden="true" class="header-anchor">#</a> 3. 团队的开发流程？</h2> <h2 id="_4-如何防止首页白屏？"><a href="#_4-如何防止首页白屏？" aria-hidden="true" class="header-anchor">#</a> 4. 如何防止首页白屏？</h2> <p><strong>首屏时间</strong>（<code>First Contentful Paint</code>），指的是浏览器从响应用户输入网址地址，到首屏内容渲染完成的时间，此时整个网页不一定要全部渲染完成，但需要展示当前视窗需要的内容</p> <p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X2pwZy9nSDMxdUY5VklpYlNUZ0szaWNjaWJBVnBPMjJpY1BrRmtXRmljaG1waWNBSUY4akx6RU8yNnFMZ1cwUTM0TEpNZHFrTVZmSnFEenh2MXI2dVd2QzdkRTJpYk5DcUEvNjQw?x-oss-process=image/format,png" alt></p> <ul><li>通过 <code>DOMContentLoad</code> 或者 <code>performance</code> 来计算出首屏时间?</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 方案一：</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'first contentful painting'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 方案二：</span>
performance<span class="token punctuation">.</span><span class="token function">getEntriesByName</span><span class="token punctuation">(</span><span class="token string">&quot;first-contentful-paint&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>startTime

<span class="token comment">// performance.getEntriesByName(&quot;first-contentful-paint&quot;)[0]</span>
<span class="token comment">// 会返回一个 PerformancePaintTiming的实例，结构如下：</span>
<span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&quot;first-contentful-paint&quot;</span><span class="token punctuation">,</span>
  entryType<span class="token punctuation">:</span> <span class="token string">&quot;paint&quot;</span><span class="token punctuation">,</span>
  startTime<span class="token punctuation">:</span> <span class="token number">507.80000002123415</span><span class="token punctuation">,</span>
  duration<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>先说下 <code>Spa 单页面</code> 的加载过程: 首先就是 <code>html</code>,也就是 <code>FP 阶段</code>; 然后是静态资源 <code>css</code>，<code>js</code>，之后<code>解析 js</code>，生成 <code>HTML</code>,也就是 <code>FCP 阶段</code>，<code>css</code>, <code>js</code> 资源加载下来了，首次的内容绘制，有一个大结构了; 到最后,就是 <code>FMP</code>,ajax 请求数据之后,首次有效绘制,就是页面加载差不多了，但是可能图片还没加载出来</p> <p><strong>总结</strong>: 从 <code>FP</code> 到 <code>FMP</code> 这个过程全是 <strong>白屏</strong>，可能你的 <code>header</code> 如果有啥大背景色啊，这个背景色或许会出来,<code>ajax</code> 之后，才会真正去解析我们的数据,把数据放入我们的 <code>html</code> 标签中
<img src="https://img-blog.csdnimg.cn/20201020201657375.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTM4OTA1MQ==,size_16,color_FFFFFF,t_70#pic_center" alt></p> <ul><li><p>加载慢的原因</p> <p>在页面渲染的过程，导致加载速度慢的因素可能如下：</p> <ol><li>网络延时问题</li> <li>资源文件体积是否过大</li> <li>资源是否重复发送请求去加载了</li> <li>加载脚本的时候，渲染内容堵塞了</li></ol></li> <li><p>解决方案:</p> <ol><li><p><strong>减少入口文件体积</strong></p> <p>常用的手段是 <code>路由懒加载</code>，把不同路由对应的组件分割成不同的代码块，待路由被请求的时候会单独打包路由，使得入口文件变小，加载速度大大增加</p> <p>在 <code>vue-router</code> 配置路由的时候，采用动态加载路由的形式:</p> <div class="language-js extra-class"><pre class="language-js"><code>routes<span class="token punctuation">:</span><span class="token punctuation">[</span>
   path<span class="token punctuation">:</span> <span class="token string">'Test'</span><span class="token punctuation">,</span>
   name<span class="token punctuation">:</span> <span class="token string">'Test'</span><span class="token punctuation">,</span>
   <span class="token function-variable function">component</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./components/Test.vue'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p><strong>静态资源本地缓存</strong></p> <p>后端返回资源问题：</p> <ul><li>采用 <code>HTTP 缓存</code>，设置 <code>Cache-Control</code>，<code>Last-Modified</code>，<code>Etag</code> 等响应头</li> <li>采用 <code>Service Worker</code> 离线缓存</li></ul> <p>前端合理利用 <code>localStorage</code></p></li> <li><p><strong>UI 框架按需加载</strong></p></li> <li><p><strong>图片资源的压缩</strong></p> <p>对大图片进行压缩、对 <code>icon 图</code>可以使用在线字体图标或者雪碧图，将众多小图标合并到同一张图上，用以减轻 <code>http</code> 请求压力。</p></li> <li><p><strong>组件重复打包</strong></p> <p>如果一个依赖库被多个文件引入会多次打包。<strong>解决方案</strong>：在 <code>webpack</code> 的 <code>config</code> 文件中，修改 <code>CommonsChunkPlugin</code> 的配置。<code>minChunks</code> 为 3 表示会把使用 3 次及以上的包抽离出来，放进公共依赖文件，避免了重复加载组件</p></li> <li><p><strong>开启 GZip 压缩</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">CompressionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/\.js$|\.html$|\.css/</span><span class="token punctuation">,</span> <span class="token comment">// 匹配文件名</span>
    threshold<span class="token punctuation">:</span> <span class="token number">10240</span><span class="token punctuation">,</span> <span class="token comment">// 对超过10k的数据进行压缩</span>
    deleteOriginalAssets<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否删除原文件</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p><strong>使用 SSR</strong></p> <p><code>SSR（Server side ）</code>，也就是 <code>服务端渲染</code>，组件或页面通过服务器生成 <code>html 字符串</code>，再发送到浏览器</p> <blockquote><p>vue -&gt; Nuxt.js, react -&gt; Next.js</p></blockquote></li></ol></li> <li><p>减少首屏渲染时间的方法有很多，总的来讲可以分成两大部分 ：<code>资源加载优化</code> 和 <code>页面渲染优化</code></p> <p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9nSDMxdUY5VklpYlNUZ0szaWNjaWJBVnBPMjJpY1BrRmtXRmljTEVZQW5GNHJCVjZiaFdUS0hLUGliMEs1cEhBRDhEZFZYNDRQRUtFaGtPeDBDRFlacmlhd2tIRmcvNjQw?x-oss-process=image/format,png" alt></p></li> <li><p>解决办法：</p> <ol><li><p><code>预渲染</code></p></li> <li><p><code>SSR</code></p></li> <li><p><code>路由懒加载</code></p></li> <li><p><code>使用 Gzip 压缩</code></p></li> <li><p><code>webpack entry</code> 多页应用</p></li> <li><p>骨架屏（原理）</p></li> <li><p><code>loading</code></p> <p>在首页 <code>index.html</code> 里加一个 <code>loading css</code> 效果，当页面加载完成消失</p></li></ol></li></ul> <h2 id="_5-怎么理解前端工程化、模块化、组件化"><a href="#_5-怎么理解前端工程化、模块化、组件化" aria-hidden="true" class="header-anchor">#</a> 5. 怎么理解前端工程化、模块化、组件化?</h2> <ul><li><strong>工程化</strong>：是一种思想而不是某种技术，而模块化和组件化是为工程化思想下相对较具体的开发方式。可以简单的认为模块化和组件化是工程化的表现形式</li> <li><strong>模块化开发</strong>：一个模块就是一个实现特定功能的文件，有了模块我们就可以更方便的使用别人的代码，要用什么功能就加载什么模块
<ul><li>模块化开发的好处：
<ol><li>提高代码复用率和维护性</li> <li>避免变量污染、命名冲突</li></ol></li></ul></li> <li><strong>组件化开发</strong>：就是将一个页面拆分成很多的小组件</li></ul> <h2 id="_6-微前端中的渲染、js-沙箱、样式隔离、数据通信"><a href="#_6-微前端中的渲染、js-沙箱、样式隔离、数据通信" aria-hidden="true" class="header-anchor">#</a> 6. 微前端中的渲染、JS 沙箱、样式隔离、数据通信?</h2> <h2 id="_7-如何实现扫码登录功能？"><a href="#_7-如何实现扫码登录功能？" aria-hidden="true" class="header-anchor">#</a> 7. 如何实现扫码登录功能？</h2> <ul><li>访问 PC 端二维码生成页面，PC 端请求服务端获取 <code>二维码ID</code></li> <li>服务端生成相应的<code>二维码ID</code>，设置二维码的过期时间，状态等。</li> <li>PC 获取<code>二维码ID</code>，生成相应的二维码。</li> <li>手机端扫描二维码，获取<code>二维码ID</code>。</li> <li>手机端将<code>手机端token</code>和<code>二维码ID</code>发送给服务端，确认登录。</li> <li>服务端校验<code>手机端token</code>，根据<code>手机端token</code>和<code>二维码ID</code>生成 PC 端<code>token</code></li> <li>PC 端通过<code>轮询方式</code>请求服务端，通过二维码 ID 获取二维码状态，如果已成功，返回 PC token，登录成功。</li></ul> <p><strong>扩展</strong>：轮询方式有哪些，以及它们各自的优缺点？</p> <ul><li><p><strong>轮询</strong></p> <p><code>基本思路</code>: 就是浏览器每隔一段时间向浏览器发送 <code>http 请求</code>，服务器端在收到请求后，不论是否有数据更新，都直接进行响应。这种方式实现的即时通信，本质上还是浏览器发送请求，服务器接受请求的一个过程，通过让客户端不断的进行请求，使得客户端能够模拟实时地收到服务器端的数据的变化。</p> <p><strong>优点</strong>: 是比较简单，易于理解，实现起来也没有什么技术难点。</p> <p><strong>缺点</strong>: 由于需要不断的建立 http 连接，严重浪费了服务器端和客户端的资源. 人数越多，服务器端压力越大，这是很不合理的。</p></li> <li><p><strong>长轮询</strong></p> <p><code>基本思路</code>: 服务器收到客户端发来的请求后,服务器端不会直接进行响应，而是先将这个请求挂起，然后判断服务器端数据是否有更新。如果有更新，则进行响应，如果一直没有数据，则到达一定的时间限制(服务器端设置)才返回。客户端 <code>JavaScript 响应</code>处理函数会在处理完服务器返回的信息后，再次发出请求，重新建立连接。</p> <p><strong>优点</strong>: 减少了很多不必要的 http 请求次数，相比之下节约了资源</p> <p><strong>缺点</strong>: 接挂起也会导致资源的浪费</p> <p><strong>轮询与长轮询都是基于 HTTP 的</strong></p></li> <li><p><strong>长连接</strong>（SSE）
<code>SSE</code> 是 <code>HTML5</code> 新增的功能，全称为 <code>Server-Sent Events</code>。它可以允许服务推送数据到客户端。<code>SSE</code> 在本质上就与之前的长轮询、短轮询不同，虽然都是基于 <code>http 协议</code>的，但是轮询需要客户端先发送请求。而 <code>SSE</code> 最大的特点就是不需要客户端发送请求，可以实现只要服务器端数据有更新，就可以马上发送到客户端。</p> <p><strong>优点</strong>: 它不需要建立或保持大量的客户端发往服务器端的请求，节约了很多资源，提升应用性能</p></li> <li><p><strong>WebSocket</strong></p> <p><code>WebSocket</code> 是 <code>Html5</code> 定义的一个新协议，与传统的 <code>http 协议</code>不同，该协议可以实现服务器与客户端之间<code>全双工通信</code></p></li></ul> <h2 id="_8-如何防止重复发送请求？"><a href="#_8-如何防止重复发送请求？" aria-hidden="true" class="header-anchor">#</a> 8. 如何防止重复发送请求？</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">let</span> <span class="token function-variable function">promiseFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    window<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">rs</span><span class="token punctuation">(</span>count<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token keyword">let</span> firstFn <span class="token operator">=</span> <span class="token function">firstPromise</span><span class="token punctuation">(</span>promiseFunction<span class="token punctuation">)</span>
<span class="token function">firstFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token function">firstFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token function">firstFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span> <span class="token comment">// 1</span>

<span class="token keyword">function</span> <span class="token function">firstPromise</span><span class="token punctuation">(</span><span class="token parameter">promiseFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 请求的实例，已存在意味着正在请求中，直接返回实例，不触发新的请求</span>
    <span class="token keyword">return</span> p
      <span class="token operator">?</span> p
      <span class="token punctuation">:</span> <span class="token comment">// 否则发送请求，且在finally时将p置空，那么下一次请求可以重新发起</span>
        <span class="token punctuation">(</span>p <span class="token operator">=</span> <span class="token function">promiseFunction</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>扩展</strong>：前端做后台管控系统，在某些接口请求时间过长的场景下，需要防止用户反复发起请求，实现方式也有好几种：</p> <ol><li>在按钮点击发起请求后，弹个蒙层，显示个 loading，等请求数据返回了将蒙层隐藏掉</li> <li>在按钮点击发起请求后，将按钮禁用掉，同样等数据返回了将按钮禁用解除</li></ol> <p>以上两种方案优点仅仅是简单，但是每个需要处理的页面都要单独写一串重复的代码，哪怕利用 mixin 也要多不少冗余代码。利用指令的方式仅仅需要在合适的地方加上个一条 v-xxxx，其他都在指令的逻辑内统一处理。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> forbidClick <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">bind</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> el <span class="token operator">=</span> e
    <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token function-variable function">forbidClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span>
      el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'is-disabled'</span><span class="token punctuation">)</span>
      timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>currentRes<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
          el<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span>
          el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'is-disabled'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> forbidClick<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">unbind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> forbidClick<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// 再考虑请求，记录当前请求是否完成。请求拦截器中，接口请求时长超过3s，则视为完成，不管请求结果成功或失败</span>
</code></pre></div><p>这样就实现了只要在按钮上加上了 v-clickForbidden。按钮点击后就会被禁用，仅当某个请求返回数据或者 3s 后将按钮的禁用解除</p> <h2 id="_9-实现一个页面操作不会整页刷新的网站"><a href="#_9-实现一个页面操作不会整页刷新的网站" aria-hidden="true" class="header-anchor">#</a> 9. 实现一个页面操作不会整页刷新的网站</h2> <p>实现一个页面操作不会整页刷新的网站，并且能在浏览器的前进，后退时正确响应。给出你的技术实现方案？</p> <ul><li><p>方式一
用 cookie 或者 localStorage 来记录应用的状态即可，刷新页面时读取一下这个状态，然后发送相应 ajax 请求来改变页面即可（<strong>注意</strong>：ajax 可以无刷新改变页面内容，但无法改变页面 URL；ajax 的使用对搜索引擎很不友好）</p></li> <li><p>方式二
HTML5 里引用了新的 API，就是 history.pushState 和 history.replaceState，就是通过这个接口做到无刷新改变页面 URL 的</p> <p>通过 pushState 和 replaceState 接口操作浏览器历史，并且改变当前页面的 URL。pushState 是将指定的 URL 添加到浏览器历史里，replaceState 是将指定的 URL 替换当前的 URL。（<strong>注意</strong>：通过 onpopstate 事件来响应浏览器的前进和后退的操作）</p></li> <li><p>方式三
内容发生改变后，改变 URL 的 hash。（<strong>注意</strong>：hash 的方式不能很好的处理浏览器的前进、后退等问题，通过 onhashchange 事件监听 hash 的改变）</p></li></ul> <p><strong>总结</strong>：结合 ajax 和 pushState 完美的进行无刷新浏览了</p> <p><strong>扩展</strong>：</p> <ol><li><p>window.history.back() -- 相当于用户在浏览器的工具栏上点击返回按钮</p></li> <li><p>window.history.forward() -- 相当于用户在浏览器的工具栏上点击前进按钮</p></li> <li><p>go()方法，指定一个相对于当前页面位置的数值，从当前会话的历史记录中加载页面（当前位置页面索引：0，上一页：-1，下一页：1）
window.history.go(-2)--后退 2 页，相当于调用两次 back();</p> <p>window.history.go(1)--前进 1 页，相当于调用 forward();</p></li> <li><p>通过 window.history.length，得到历史记录栈中一共有多少页</p></li> <li><p>pushState(stateObject,title,URL)。state： 对象，存放一些数据表示当前状态。当浏览器执行前进后退操作时触发 onpopstate 事件</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onpopstate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token comment">// 当前历史记录条目的状态</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 做一些操作</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_10、如何优化单页面首屏加载白屏体验或加重速度慢问题-？"><a href="#_10、如何优化单页面首屏加载白屏体验或加重速度慢问题-？" aria-hidden="true" class="header-anchor">#</a> 10、如何优化单页面首屏加载白屏体验或加重速度慢问题 ？</h2> <ol><li>将公用的 JS 库通过 script 标签外部引入，减小 app.bundle 的大小，让浏览器并行下载资源文件，提高下载速度</li> <li>在配置 路由时，页面和组件使用懒加载的方式引入，进一步缩小 app.bundle 的体积，在调用某个组件时再加载对应的 js 文件</li> <li>root 中插入 loading 或者 骨架屏 prerender-spa-plugin，提升用户体验（<code>saas项目中添加 loading 来防止白屏</code>）</li> <li>如果在 webview 中的页面，可以进行页面预加载</li> <li>独立打包异步组件公共 Bundle，以提高复用性&amp;缓存命中率</li> <li>静态文件本地缓存，有两种方式分别为 HTTP 缓存，设置 Cache-Control，Last-Modified，Etag 等响应头和 Service Worker 离线缓存</li> <li>配合 PWA 使用</li> <li>SSR</li> <li>使用 Tree Shaking 减少业务代码体积</li></ol> <ul><li>懒加载和预加载的区别？
<ol><li>预加载是指在页面加载完成之前，提前将所需资源下载，之后使用的时候从缓存中调用；懒加载是延迟加载，按照一定的条件或者需求等到满足条件的时候再加载对应的资源</li> <li>预加载增加了服务器压力，换来的是用户体验的提升，典型例子是在一个图片较多的网页中，如果使用了预加载就可以避免网页加载出来是时，图片的位置一片空白（图片可能还没加载出来），造成不好的用户体验；懒加载的作用减少不要的请求，缓解了服务器压力</li></ol></li></ul> <h2 id="_11-如何设计一个-vue-组件？"><a href="#_11-如何设计一个-vue-组件？" aria-hidden="true" class="header-anchor">#</a> 11. 如何设计一个 Vue 组件？</h2> <h2 id="_12-如何开发一个开源组件库？"><a href="#_12-如何开发一个开源组件库？" aria-hidden="true" class="header-anchor">#</a> 12. 如何开发一个开源组件库？</h2> <h2 id="_13-如何统一对错误进行捕获的？"><a href="#_13-如何统一对错误进行捕获的？" aria-hidden="true" class="header-anchor">#</a> 13. 如何统一对错误进行捕获的？</h2> <h2 id="_14-vue-的异步错误如何捕获？"><a href="#_14-vue-的异步错误如何捕获？" aria-hidden="true" class="header-anchor">#</a> 14. vue 的异步错误如何捕获？</h2> <h2 id="_15-如如何用鉴权控制登陆时间设计保持七天登录状态？"><a href="#_15-如如何用鉴权控制登陆时间设计保持七天登录状态？" aria-hidden="true" class="header-anchor">#</a> 15. 如如何用鉴权控制登陆时间设计保持七天登录状态？</h2> <h2 id="_16-为什么-b-站的弹幕可以不挡人物"><a href="#_16-为什么-b-站的弹幕可以不挡人物" aria-hidden="true" class="header-anchor">#</a> 16. 为什么 B 站的弹幕可以不挡人物?</h2> <p>利用 CSS 中新增的-webkit-mask-image 属性</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/chapter16/optimize.html" class="prev">
          优化部分
        </a></span> <span class="next"><a href="/chapter16/inter.html">
          2022
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.c45b4ff4.js" defer></script><script src="/assets/js/74.92f12f63.js" defer></script>
  </body>
</html>
